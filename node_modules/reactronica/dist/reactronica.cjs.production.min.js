"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var n=require("react"),t=e(n),r=e(require("startaudiocontext")),o=e(require("tone")),u=e(require("fast-deep-equal")),i=t.createContext({isPlaying:!1});function c(e,n){return"string"==typeof e?{notes:[{name:e}],index:n}:e&&e.name?{notes:[{name:e.name,duration:e.duration,velocity:e.velocity}],index:n}:Array.isArray(e)?{notes:e.map((function(e){return"string"==typeof e?{name:e}:e})),index:n}:{notes:[],index:n}}function a(e){var t=n.useRef();return n.useEffect((function(){t.current=e}),[e]),t.current}var s=t.createContext({volume:0,pan:0,mute:!1,solo:!1,effectsChain:null,onInstrumentsUpdate:null,onAddToEffectsChain:null,onRemoveFromEffectsChain:null}),f=function(e){var r=e.isPlaying,i=e.steps,f=void 0===i?[]:i,l=e.volume,d=void 0===l?0:l,p=e.pan,m=void 0===p?0:p,v=e.mute,y=e.solo,h=e.subdivision,E=void 0===h?"4n":h,C=e.effects,S=void 0===C?[]:C,F=e.children,w=e.onStepPlay,g=n.useState([]),A=g[0],b=g[1],D=n.useState([]),T=D[0],P=D[1],G=n.useRef(),k=n.useRef(T);n.useEffect((function(){k.current=T}),[T]);var x=f.map(c),M=a(x);return n.useEffect((function(){var e;r?(G.current=new o.Sequence((function(e,n){n.notes.forEach((function(e){k.current.forEach((function(n){n.triggerAttackRelease(e.name,e.duration||.5,void 0,e.velocity)}))})),"function"==typeof w&&w(n.notes,n.index)}),x,E),null===(e=G.current)||void 0===e||e.start(0)):G.current&&G.current.stop()}),[r]),n.useEffect((function(){G.current&&((null==M?void 0:M.length)===x.length?x.forEach((function(e,n){var t,r;u(x[n].notes,M&&M[n]?M[n].notes:[])||(null===(t=G.current)||void 0===t||t.remove(n),null===(r=G.current)||void 0===r||r.add(n,e))})):(G.current.removeAll(),x.forEach((function(e,n){G.current.add(n,e)}))))}),[JSON.stringify(x)]),n.useEffect((function(){return function(){G.current&&G.current.dispose()}}),[]),t.createElement(s.Provider,{value:{effectsChain:A,pan:m,volume:d,mute:v,solo:y,onInstrumentsUpdate:function(e){P(e)},onAddToEffectsChain:function(e){b((function(n){return[e].concat(n)}))},onRemoveFromEffectsChain:function(e){b((function(n){return n.filter((function(n){return n.id!==e.id}))}))}}},F,S)};function l(){return(l=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)}var d=function(e){var t=e.type,r=void 0===t?"synth":t,u=e.options,i=e.polyphony,c=void 0===i?4:i,s=e.oscillator,f=e.envelope,l=e.notes,d=void 0===l?[]:l,m=e.samples,v=e.onLoad,y=e.volume,h=e.pan,E=e.mute,C=e.solo,S=e.effectsChain,F=e.onInstrumentsUpdate,w=n.useRef(),g=n.useRef(null),A=a(d);n.useEffect((function(){return g.current=new o.Channel(y,h),function(){g.current&&g.current.dispose()}}),[]);var b=a(r);n.useEffect((function(){var e;return"sampler"===r?(w.current=new o.Sampler(m,v),u&&u.curve&&(w.current.curve=u.curve),u&&u.release&&(w.current.release=u.release)):w.current="membraneSynth"===r?new o.MembraneSynth(p({oscillator:s,envelope:f})):"metalSynth"===r?new o.MetalSynth:"noiseSynth"===r?new o.NoiseSynth:"pluckSynth"===r?new o.PluckSynth:new o.PolySynth(c,"amSynth"===r?o.AMSynth:"duoSynth"===r?o.DuoSynth:"fmSynth"===r?o.FMSynth:"monoSynth"===r?o.MonoSynth:o.Synth,p({oscillator:s,envelope:f})),(e=w.current).chain.apply(e,S.concat([g.current,o.Master])),F([w.current]),function(){w.current&&w.current.dispose()}}),[r,c]),n.useEffect((function(){"synth"===r&&w&&w.current&&s&&w.current.set("oscillator",s)}),[s,r]),n.useEffect((function(){g.current.volume.value=y}),[y]),n.useEffect((function(){g.current.pan.value=h}),[h]),n.useEffect((function(){g.current.mute=E}),[E]),n.useEffect((function(){g.current.solo=C}),[C]),n.useEffect((function(){d&&d.forEach((function(e){A&&A.filter((function(n){return n.name===e.name&&n.key===e.key})).length>0||(e.duration?w.current.triggerAttackRelease(e.name,e.duration,void 0,e.velocity):w.current.triggerAttack(e.name,void 0,e.velocity))})),A&&A.forEach((function(e){d&&d.filter((function(n){return n.name===e.name})).length>0||w.current.triggerRelease(e.name)}))}),[d,A]),n.useEffect((function(){var e;w.current.disconnect(),(e=w.current).chain.apply(e,S.concat([g.current,o.Master]))}),[S]);var D=a(m);return n.useEffect((function(){var e="sampler"===r&&b!==r;if("sampler"===r&&Boolean(m)&&!e){var n=Object.keys(D),t=Object.keys(m).filter((function(e){return!n.includes(e)}));if(t.length){var o=t.map((function(e){return new Promise((function(n){var t=m[e];t!==(D?D[e]:"")?w.current.add(e,t,n):n(null)}))}));Promise.all(o).then((function(e){"function"==typeof v&&v(e)}))}}}),[m,r]),null},p=function(e){var n=e.oscillator,t=e.envelope;if(n||t)return l({},t?{envelope:t}:{},n?{oscillator:n}:{})},m=function(e){var t=e.type,r=e.id,u=e.delayTime,i=void 0===u?"8n":u,c=e.feedback,a=void 0===c?.5:c,s=e.wet,f=void 0===s?1:s,l=e.low,d=e.mid,p=e.high,m=e.lowFrequency,v=e.highFrequency,y=e.onAddToEffectsChain,h=e.onRemoveFromEffectsChain,E=n.useRef();return n.useEffect((function(){return"autoFilter"===t?E.current=new o.AutoFilter:"autoPanner"===t?E.current=new o.AutoPanner:"autoWah"===t?E.current=new o.AutoWah:"bitCrusher"===t?E.current=new o.BitCrusher:"distortion"===t?E.current=new o.Distortion(.5):"feedbackDelay"===t?E.current=new o.FeedbackDelay(i,a):"freeverb"===t?E.current=new o.Freeverb:"panVol"===t?E.current=new o.PanVol:"tremolo"===t?E.current=new o.Tremolo:"eq3"===t&&(E.current=new o.EQ3(l,d,p)),E.current&&(E.current.id=r,y(E.current)),function(){h(E.current)}}),[t]),n.useEffect((function(){E.current&&E.current.feedback&&(E.current.feedback.value=a)}),[a]),n.useEffect((function(){E.current&&E.current.delayTime&&(E.current.delayTime.value=i)}),[i]),n.useEffect((function(){E.current&&E.current.wet&&(E.current.wet.value=f)}),[f]),n.useEffect((function(){void 0!==l&&E.current&&E.current.low&&(E.current.low.value=l)}),[l]),n.useEffect((function(){void 0!==d&&E.current&&E.current.mid&&(E.current.mid.value=d)}),[d]),n.useEffect((function(){void 0!==p&&E.current&&E.current.high&&(E.current.high.value=p)}),[p]),n.useEffect((function(){void 0!==m&&E.current&&E.current.lowFrequency&&(E.current.lowFrequency.value=m)}),[m]),n.useEffect((function(){void 0!==v&&E.current&&E.current.highFrequency&&(E.current.highFrequency.value=v)}),[v]),null};exports.Effect=function(e){var r=n.useContext(s);return t.createElement(m,Object.assign({onAddToEffectsChain:r.onAddToEffectsChain,onRemoveFromEffectsChain:r.onRemoveFromEffectsChain},e))},exports.Instrument=function(e){var r=e.type,o=e.options,u=e.notes,i=e.polyphony,c=e.oscillator,a=e.envelope,f=e.samples,l=e.onLoad,p=n.useContext(s);return"undefined"==typeof window?null:t.createElement(d,{type:r,options:o,notes:u,polyphony:i,oscillator:c,envelope:a,samples:f,onLoad:l,volume:p.volume,pan:p.pan,mute:p.mute,solo:p.solo,effectsChain:p.effectsChain,onInstrumentsUpdate:p.onInstrumentsUpdate})},exports.Song=function(e){var u=e.isPlaying,c=void 0!==u&&u,a=e.bpm,s=void 0===a?90:a,f=e.swing,l=void 0===f?0:f,d=e.swingSubdivision,p=void 0===d?"8n":d,m=e.volume,v=void 0===m?0:m,y=e.isMuted,h=void 0!==y&&y,E=e.children;return n.useEffect((function(){document.body.addEventListener("click",(function(){r(o.context)}),{once:!0})}),[]),n.useEffect((function(){o.Transport.bpm.value=s,o.Transport.swing=l,o.Transport.swingSubdivision=p}),[s,l,p]),n.useEffect((function(){c?(o.Transport.bpm.value=s,o.Transport.swing=l,o.Transport.swingSubdivision=p,o.Transport.start()):o.Transport.stop()}),[c]),n.useEffect((function(){o.Master.volume.value=v}),[v]),n.useEffect((function(){o.Master.mute=h}),[h]),"undefined"==typeof window?null:t.createElement(i.Provider,{value:{isPlaying:c}},E)},exports.Track=function(e){var n=t.useContext(i);return"undefined"==typeof window?null:t.createElement(f,Object.assign({isPlaying:n.isPlaying},e))},exports.config={instruments:[{id:"amSynth",name:"AM Synth",props:["polyphony","oscillatorType"]},{id:"duoSynth",name:"Duo Synth",props:["polyphony","oscillatorType"]},{id:"fmSynth",name:"FM Synth",props:["polyphony","oscillatorType"]},{id:"membraneSynth",name:"Membrane Synth",props:[]},{id:"metalSynth",name:"Metal Synth",props:[]},{id:"monoSynth",name:"Mono Synth",props:["polyphony","oscillatorType"]},{id:"pluckSynth",name:"Pluck Synth",props:[]},{id:"sampler",name:"Sampler",props:["samples"]},{id:"synth",name:"Synth",props:["polyphony","oscillatorType"]}],effects:[{id:"autoFilter",name:"Auto Filter"},{id:"autoPanner",name:"Auto Panner"},{id:"autoWah",name:"Auto Wah"},{id:"bitCrusher",name:"Bit Crusher"},{id:"distortion",name:"Distortion"},{id:"feedbackDelay",name:"Feedback Delay"},{id:"freeverb",name:"Freeverb"},{id:"panVol",name:"Volume/Pan"},{id:"tremolo",name:"Tremolo"},{id:"eq3",name:"EQ3"}]},exports.midiNotes=["C-2","C#-2","D-2","D#-2","E-2","F-2","F#-2","G-2","G#-2","A-2","A#-2","B-2","C-1","C#-1","D-1","D#-1","E-1","F-1","F#-1","G-1","G#-1","A-1","A#-1","B-1","C0","C#0","D0","D#0","E0","F0","F#0","G0","G#0","A0","A#0","B0","C1","C#1","D1","D#1","E1","F1","F#1","G1","G#1","A1","A#1","B1","C2","C#2","D2","D#2","E2","F2","F#2","G2","G#2","A2","A#2","B2","C3","C#3","D3","D#3","E3","F3","F#3","G3","G#3","A3","A#3","B3","C4","C#4","D4","D#4","E4","F4","F#4","G4","G#4","A4","A#4","B4","C5","C#5","D5","D#5","E5","F5","F#5","G5","G#5","A5","A#5","B5","C6","C#6","D6","D#6","E6","F6","F#6","G6","G#6","A6","A#6","B6","C7","C#7","D7","D#7","E7","F7","F#7","G7","G#7","A7","A#7","B7","C8","C#8","D8","D#8","E8","F8","F#8","G8"];
//# sourceMappingURL=reactronica.cjs.production.min.js.map
